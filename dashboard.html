<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Pauser pr. time</h1>
  <div class="center">
    <canvas id="chart" height="120"></canvas>
  </div>

  <script type="module">
  import { parseEvents } from './js/parser.js';
  import { groupByHour } from './js/aggregator.js';

  const WORKER = "https://YOUR_WORKER_URL"; // sÃ¦t din worker URL her

  function computeMedian(arr) {
    const s = [...arr].sort((a,b)=>a-b);
    const mid = Math.floor(s.length/2);
    return s.length ? (s.length % 2 ? s[mid] : (s[mid-1]+s[mid])/2) : 0;
  }

  async function loadAndRender(hours = 24) {
    const res = await fetch(`${WORKER}/events`);
    const raw = await res.json();
    const events = parseEvents(raw);
    const { labels, values } = groupByHour(events, hours);

    const median = computeMedian(values);

    const ctx = document.getElementById('chart').getContext('2d');
    if (window._ppChart) window._ppChart.destroy();

    window._ppChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [
          { label: 'Pauser pr. time', data: values, borderColor: '#0078d4', backgroundColor: 'rgba(0,120,212,0.08)', fill: true, tension: 0.2, pointRadius: 3 },
          { label: 'Median', data: labels.map(()=>median), borderColor: 'red', borderDash: [6,4], pointRadius: 0, fill: false }
        ]
      },
      options: {
        scales: {
          x: { title: { display: true, text: 'Time (lokal)' } },
          y: { beginAtZero: true, title: { display: true, text: 'Antal tryk' } }
        }
      }
    });
  }

  // initial render
  loadAndRender(24);

  // auto refresh hvert 60 sekunder
  setInterval(()=>loadAndRender(24), 60_000);
  </script>
</body>
</html>
