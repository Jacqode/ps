<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <title>Plug & Pause â€“ Firma J</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }

    #widget {
      border: 1px solid #ccc;
      padding: 20px;
      width: 100%;
      margin-bottom: 40px;
      border-radius: 8px;
    }

    #feed div {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      font-size: 15px;
    }

    h2 {
      margin-top: 40px;
    }

    #toggleMuteBtn {
      margin-top: 10px;
    }
  </style>
</head>

<body>

  <h1>Plug & Pause â€“ Firma J</h1>

  <!-- Widget container -->
  <div id="widget">
    <button id="rollBtn">Rul terning</button>
    <p id="aktivitet">â€“</p>
    <button id="doneBtn">FÃ¦rdig</button>
    <p id="status"></p>
  </div>

  <!-- Mute-knap -->
  <button id="toggleMuteBtn">SlÃ¥ pÃ¥mindelser fra</button>
  <p id="muteStatus"></p>

  <!-- Socialt feed -->
  <h2>Socialt feed</h2>
  <div id="feed">IndlÃ¦serâ€¦</div>

  <!-- Widget script -->
  <script type="module" src="widget.js?companyId=FIRMAJ"></script>

  <!-- Feed + PÃ¥mindelser script -->
  <script>
    // ---------------------------------------------------------
    // FEED
    // ---------------------------------------------------------
    async function loadFeed() {
      const companyId = "FIRMAJ";

      const res = await fetch(
        `https://plugandpause-backend.jakobhelkjaer.workers.dev/api/feed?groupId=${companyId}`
      );

      const events = await res.json();
      const feedDiv = document.getElementById("feed");
      feedDiv.innerHTML = "";

      if (events.length === 0) {
        feedDiv.textContent = "Ingen aktiviteter endnu.";
        return;
      }

      events.forEach(ev => {
        const item = document.createElement("div");
        const time = new Date(ev.timestamp).toLocaleTimeString("da-DK");
        item.textContent = `${time} â€“ ${ev.userId} lavede: ${ev.activity}`;
        feedDiv.appendChild(item);
      });
    }

    loadFeed();
    setInterval(loadFeed, 10000); // auto-refresh hvert 10. sekund


    // ---------------------------------------------------------
    // PÃ…MINDELSER (formiddag + eftermiddag)
    // ---------------------------------------------------------

    // Default: ikke muted
    if (!localStorage.getItem("pp_mute")) {
      localStorage.setItem("pp_mute", "false");
    }

    const morningReminder = { hour: 10, minute: 0 };
    const afternoonReminder = { hour: 14, minute: 30 };

    function resetDailyFlags() {
      const today = new Date().toDateString();
      const last = localStorage.getItem("pp_lastReminderDate");

      if (today !== last) {
        localStorage.setItem("pp_lastReminderDate", today);
        localStorage.setItem("pp_morningDone", "false");
        localStorage.setItem("pp_afternoonDone", "false");
      }
    }

    resetDailyFlags();

    function checkReminder(target, flagName) {
      if (localStorage.getItem("pp_mute") === "true") return;

      const now = new Date();
      if (localStorage.getItem(flagName) === "true") return;

      if (now.getHours() === target.hour && now.getMinutes() === target.minute) {
        alert("Tid til en lille pause! Rul terningen ðŸ˜Š");
        localStorage.setItem(flagName, "true");
      }
    }

    setInterval(() => {
      resetDailyFlags();
      checkReminder(morningReminder, "pp_morningDone");
      checkReminder(afternoonReminder, "pp_afternoonDone");
    }, 60000); // tjek hvert minut


    // ---------------------------------------------------------
    // MUTE-KNAP
    // ---------------------------------------------------------
    const muteBtn = document.getElementById("toggleMuteBtn");
    const muteStatus = document.getElementById("muteStatus");

    function updateMuteUI() {
      const muted = localStorage.getItem("pp_mute") === "true";
      muteBtn.textContent = muted ? "SlÃ¥ pÃ¥mindelser til" : "SlÃ¥ pÃ¥mindelser fra";
      muteStatus.textContent = muted ? "PÃ¥mindelser er slÃ¥et fra" : "PÃ¥mindelser er aktive";
    }

    muteBtn.onclick = () => {
      const current = localStorage.getItem("pp_mute") === "true";
      localStorage.setItem("pp_mute", current ? "false" : "true");
      updateMuteUI();
    };

    updateMuteUI();
  </script>

</body>
</html>
