<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <title>Plug & Pause – Firma J</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding-top:40px; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; background:#fff; color:#111; }
    .widget-container { max-width:420px; width:100%; text-align:left; padding:0 18px; }
    h2 { margin:0 0 8px 0; font-size:20px; }
    p.lead { font-size:16px; margin:10px 0 6px 0; color:#222; }
    #nextPause { margin:6px 0 14px 0; font-size:15px; opacity:0.85; }
    button { padding:10px 15px; margin:6px 0; width:100%; font-size:16px; cursor:pointer; border-radius:8px; border:1px solid #ddd; background:#f7f7f7; }
    #ideaBtn { background:#fff; }
    #doneBtn { background:#e8f5e9; border-color:#c8e6c9; }
    #currentIdea { margin:10px 0; font-weight:700; min-height:22px; }
    #microFeedback { display:none; background:#e6ffe6; border:1px solid #b2ffb2; padding:10px; margin-top:10px; border-radius:6px; color:#2d7a2d; font-weight:600; }
    #feedContainer { background:#fafafa; border:1px solid #eee; padding:6px; border-radius:6px; overflow-y:auto; max-height:260px; margin-top:8px; }
    .feed-item { padding:8px 6px; border-bottom:1px solid #f0f0f0; font-size:14px; }
    .feed-item:last-child { border-bottom:none; }
    .meta { opacity:0.7; font-size:13px; margin-left:6px; }
    a.settings-link { font-size:14px; opacity:0.85; text-decoration:underline; color:inherit; display:block; margin:12px 0; }
    #logo { margin-top:18px; text-align:center; opacity:0.75; font-size:13px; }
    .pp-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .pp-card { background: #fff; padding: 20px; border-radius: 12px; width: 320px; text-align: center; box-shadow: 0 6px 18px rgba(0,0,0,0.18); }
    .pp-card h3 { margin: 0 0 10px 0; font-size: 20px; }
    .pp-card p { margin: 0 0 16px 0; color:#333; }
    .pp-card button { padding: 10px 12px; width: 100%; margin-top: 6px; border-radius: 6px; border: 1px solid #ddd; background: #f7f7f7; cursor: pointer; font-size: 15px; }
    .pp-card button.primary { background: #0078d4; color: white; border-color: transparent; }
  </style>
</head>
<body>
  <div class="widget-container">
    <h2 id="greeting"></h2>

    <p class="lead">20–60 sekunders let aktivitet øger energien.</p>

    <!-- Nedtælling står under teksten -->
    <div id="nextPause">Næste pause beregnes…</div>

    <button id="ideaBtn">Klik og få en let aktivitet</button>

    <div id="currentIdea"></div>

    <button id="doneBtn">Sådan — jeg er færdig</button>

    <!-- MicroFeedback viser kun "Godt gået, Navn!" eller "Godt gået!" -->
    <div id="microFeedback">Godt gået!</div>

    <div class="section" style="margin-top:18px;">
      <h3>Andres pauser med bevægelse</h3>
      <div id="feedContainer">
        <div id="feed">Indlæser…</div>
      </div>
    </div>

    <a href="settings.html" class="settings-link">Indstillinger</a>

    <div id="logo">Plug ’n’ Pause</div>
  </div>

  <script src="widget.js?v=24"></script>

  <script>
    // Reminder + nedtælling (viser sekunder under 60s)
    let nextPauseTime = null;
    let reminderTimeoutId = null;

    function getInterval() {
      return Number(localStorage.getItem("pp_interval_min")) || 40;
    }

    function scheduleReminder(msOverride) {
      if (reminderTimeoutId) clearTimeout(reminderTimeoutId);
      const intervalMs = typeof msOverride === "number" ? msOverride : getInterval() * 60 * 1000;
      nextPauseTime = Date.now() + intervalMs;
      updateCountdown();
      reminderTimeoutId = setTimeout(showPPModal, intervalMs);
    }

    function updateCountdown() {
      const el = document.getElementById("nextPause");
      if (!nextPauseTime || !el) return;

      const diff = Math.max(0, nextPauseTime - Date.now());
      if (diff === 0) {
        el.textContent = "⏱ Pause nu!";
        return;
      }

      const mins = Math.floor(diff / 60000);
      const secs = Math.floor((diff % 60000) / 1000);

      if (mins >= 1) {
        el.textContent = `⏱ Næste pause om: ${mins} min`;
        setTimeout(updateCountdown, 10000);
      } else {
        el.textContent = `⏱ Næste pause om: ${secs} sek`;
        setTimeout(updateCountdown, 1000);
      }
    }

    function showPPModal() {
      if (document.querySelector(".pp-modal")) return;

      const root = document.createElement("div");
      root.className = "pp-modal";
      root.innerHTML = `
        <div class="pp-card">
          <h3>Mikropause</h3>
          <p>Klar til en kort aktivitet?</p>
          <button class="primary" id="pp-now">Ja, giv mig en</button>
          <button id="pp-snooze">Snooze 5 min</button>
          <button id="pp-close">Luk</button>
        </div>
      `;
      document.body.appendChild(root);

      document.getElementById("pp-now").onclick = () => {
        document.getElementById("ideaBtn")?.click();
        root.remove();
        scheduleReminder();
      };
      document.getElementById("pp-snooze").onclick = () => {
        root.remove();
        scheduleReminder(5 * 60 * 1000);
      };
      document.getElementById("pp-close").onclick = () => {
        root.remove();
        scheduleReminder();
      };
    }

    // Start reminder on load and set greeting (no exclamation)
    document.addEventListener("DOMContentLoaded", () => {
      scheduleReminder();
      const savedName = localStorage.getItem("userName") || "";
      const greetingEl = document.getElementById("greeting");
      if (greetingEl) greetingEl.textContent = savedName ? `Hej ${savedName}` : "Hej";
      // microFeedback initial text handled by widget.js when actions occur
    });
  </script>
</body>
</html>
